import telebot
from telebot import types
from yookassa import Configuration, Payment

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
bot = telebot.TeleBot('7326311884:AAEWtpg3U6ZPDzp81aNzaXhOQMbFoGgtM20')

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Yookassa
Configuration.account_id = 'YOUR_ACCOUNT_ID'
Configuration.secret_key = 'YOUR_SECRET_KEY'

# –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
catalog = {
    '1': {'name': '–¢–æ–≤–∞—Ä 1', 'price': 100}
}


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
@bot.message_handler(commands=['start'])
def send_welcome(message):
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    for item_id in catalog:
        keyboard.add(types.KeyboardButton(f"üì¶ {catalog[item_id]['name']} - {catalog[item_id]['price']} ‚ÇΩ"))

    bot.send_message(
        message.chat.id,
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞:",
        reply_markup=keyboard
    )


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–∞
@bot.message_handler(func=lambda message: True)
def handle_item_selection(message):
    try:
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
        item_name = message.text.split(' - ')[0][3:]  # 3: –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —ç–º–æ–¥–∂–∏ –∏ –ø—Ä–æ–±–µ–ª–∞

        # –ò—â–µ–º —Ç–æ–≤–∞—Ä –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
        for item_id, item in catalog.items():
            if item['name'] == item_name:
                # –°–æ–∑–¥–∞–µ–º –ø–ª–∞—Ç–µ–∂
                payment = Payment()
                payment.amount = {'value': str(item['price']), 'currency': 'RUB'}
                payment.capture = True
                payment.confirmation = {
                    'type': 'redirect',
                    'return_url': 'https://your-site.com/payment-success'
                }
                payment.description = f"–ó–∞–∫–∞–∑: {item_name}"

                # –°–æ–∑–¥–∞–µ–º –ø–ª–∞—Ç–µ–∂ –≤ Yookassa
                payment = Payment.create(payment.to_dict())

                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É
                bot.send_message(
                    message.chat.id,
                    f"–î–ª—è –æ–ø–ª–∞—Ç—ã —Ç–æ–≤–∞—Ä–∞ {item_name} –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ:\n{payment.confirmation.confirmation_url}"
                )
                return

    except Exception as e:
        bot.reply_to(message, f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {str(e)}")


# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
bot.polling(none_stop=True)
